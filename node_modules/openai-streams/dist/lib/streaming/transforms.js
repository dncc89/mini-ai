import{ENCODER as i,DECODER as d}from"../../globs/shared.js";import{OpenAIError as c}from"../errors.js";const f=o=>{const e=o?.choices?.[0];if(!e)throw console.error("No choices received from OpenAI"),new c("UNKNOWN");const n=e?.text??e?.message;if(typeof n!="string")throw console.error("No text received from OpenAI choice"),new c("UNKNOWN");return n},O=async function*(o){const e=d.decode(o),r=JSON.parse(e)?.choices?.[0],{delta:t}=r??{};if(typeof t!="object")throw console.error("Received invalid delta from OpenAI in ChatParser."),new c("UNKNOWN");const{content:s}=t;s&&(yield i.encode(s))},E=async function*(o){const e=d.decode(o),n=JSON.parse(e),r=f(n);yield i.encode(r)},l=async function*(o){const e=new TextEncoder,r=new TextDecoder().decode(o),t=JSON.parse(r),{logprobs:s}=t?.choices?.[0];s&&(yield e.encode(JSON.stringify(s)))};export{O as ChatParser,l as LogprobsParser,E as TokenParser,f as getTokensFromResponse};
